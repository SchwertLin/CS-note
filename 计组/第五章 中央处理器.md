# 中央处理器设计

## CPU结构

利用大规模的IC技术，计算机系统中的控制器、运算器、寄存器组被集成到一块芯片上，形成现在的CPU的中央处理单元。

==CPU = ALU + 控制器 + 寄存器 + bp== ，(bp是数据通路)。





### CPU的功能

CPU是计算机工作的核心部件，用于控制并协调计算机的各个部件执行程序，对数据进行架构及输入输出。

1. 指令控制：CPU的首要任务就是对程序执行顺序实施控制，保证程序严格按照规定顺序执行。
2. 操作控制：一条指令的执行需要若刚哥位操作命令信号，通过微操作信号作用于CPU内部以及外部的不同部件上以完成指令功能。
3. 时间控制：每一条指令都有严格的时间顺序。
4. 数据加工：CPU能够根据指令功能的要求，对数据进行算术、逻辑及其他方面运算和加工处理。
5. 中断处理：对内部或外部的中断做出响应，进行相应的处理。
6. 其他功能：CPU能对直接存储器(DMA)请求做出响应，对复位信号(RESET)做出响应并将复位启动的入口地址送入PC中。CPU还能接收外部的时钟信号，以便形成内部的时序控制信号。





## 数据通路

​	==数据通路分为两种：共享通路和专用通路。==

共享通路(总线型)：早期的计算机基本使用总线结构(主要部件都连接在公共总线上，各部件间通过总线进行数据传输)来传输数据。但是会使得总线成为一种竞争性资源。虽然其结构简单，实现容易；但是并发性较差，需要分时使用总线，效率低下。

专用通路：现代计算机普遍使用专用通路。其并发性高、性能好；但是设计复杂，成本高。对于专用通路也可以看作是多总线结构。



### 单总线结构

只存在唯一的总线。

![](https://s3.bmp.ovh/imgs/2022/05/17/c40df2ffba9aec77.png)

对一条加法指令`ADD R0,R1`来说,使用到单总线、两个锁存器以及三个时钟周期。==这三个时钟周期会三次分时使用总线==。



### 双总线结构

![](https://s3.bmp.ovh/imgs/2022/05/17/b7a50178ba8dcd57.png)

增加了IB2数据总线，可以由通用寄存器直接到ALU的B端。要求通用寄存器同时输出两路。

对于一条加法指令`ADD R0,R1`来说,使用到双总线、一个锁存器以及两个时钟周期。



### 三总线结构

![](https://s3.bmp.ovh/imgs/2022/05/17/e2b4f44a67dae50c.png)

对于一条加法指令`ADD R0,R1`来说,使用到三总线、一个时钟周期。对于通用内存器内部的结构有要求以及增加了额外的总线。对于IB1和IB3可以通过旁路进行信息的交互。



**总结**：总的来说，总线越多，性能越好。







## 指令周期

不同的指令功能不同，数据通路也不同，执行时间不同。

对于指令执行的一般流程：

**取指令→指令译码→操作数地址计算→取操作数→数据操作指令执行→操作数地址计算→存操作数**，对于当前指令执行完毕后，需要判断是否有中断。有中断执行完毕后，返回主程序。



**基本概念**：

时钟周期：来自于震荡周期最基础的方波，也是我们通常所说的主频。只能完成一次微操作。

机器周期：从主存中取出一条指令的最短时间(从cache中取)。

指令周期：从主存中取一条指令并执行的时间，==一般包括取指令周期和执行指令周期==。（还有中断周期）

![](https://s3.bmp.ovh/imgs/2022/05/19/cc79cff44a01b8a8.png)

取指令周期：当前CPU要执行的指令从主存中PC中指定的存储单元内独出。

执行指令期：指令指定的操作被执行。

中断周期：检查挂起的中断请求操作也常作为一个子周期包含在指令周期中。





## 微操作

**微操作**：将CPU行为或功能分解后的CPU最基本的操作，分属于不同的指令子周期。微操作被定义为CPU的基本或原子操作。==每一个微操作是CPU可以实现的、不可分解的操作动作，它以含有一个寄存器传递作为标志。==每一个微操作都是通过控制器将控制信号发送到相关部件上引起部件动作而完成的。e.g.$AR←PC$

**微命令**：控制微操作完成的==信号==，由控制器产生。e.g. $PC_{in}、AR_{in}$



### 流程







## 控制器的组成









## 硬布线控制器设计

硬布线主要分为两种：即定长与变长指令周期。

定长的采用传统的三级时序结构。

变长是现代计算机更长使用的。











